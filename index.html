<!DOCTYPE html>
<html>
<head>
  <title>ITHACA | Extreme Rainfall Detection System</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.js"></script>
  <script type="text/javascript" src="static/js/bootstrap.js"></script>
  <!-- Google Charts library -->
  <script type="text/javascript"
    src="https://www.google.com/jsapi?autoload={
      'modules':[{
        'name':'visualization',
        'version':'1',
        'packages':['corechart']
      }]
    }">
  </script>
  <script type="text/javascript" src="static/js/get_table_data.js"></script>
  <link href="static/css/bootstrap.min.css" rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=PT+Sans:400,700' rel='stylesheet' type='text/css'>
  <link href="static/css/font-awesome.min.css" rel="stylesheet">
    
  <link rel="stylesheet" href="static/css/leaflet.css" />
  <link rel="stylesheet" href="static/css/leaflet-sidebar.css" />
  <link rel="stylesheet" href="static/css/erds.css" />
    
  <style>
      html, body, #map {height: 100%;}
  </style>

</head>

<body>
  <div id="sidebar" class="sidebar collapsed">
    <!-- Nav tabs -->
    <ul class="sidebar-tabs" role="tablist">
      <li><a href="#home" role="tab"><i class="fa fa-home"></i></a></li>
      <li><a href="#layers" role="tab"><i class="fa fa-bars"></i></a></li>
   <!--    <li><a href="#warnings" role="tab"><i class="fa fa-warning"></i></a></li>  -->
      <li><a href="#settings" role="tab"><i class="fa fa-gear"></i></a></li>
    </ul>

    <!-- Tab panes -->
	
    <div class="sidebar-content">
	  
	  <!-- Home -->
		  
      <div class="sidebar-pane active" id="home">
        <h1>ITHACA ERDS</h1>
        <h2>Extreme Rainfall Detection System</h2>
        <p>The Extreme Rainfall Detection System (ERDS), developed and implemented by ITHACA, is a service for the monitoring and forecasting of exceptional rainfall events, with a nearly global geographic coverage.</p>
        <p><a href="http://ithacaweb.org/projects/erds/">More info</a></p>
        <h3>Last analyzed GPM date: 
          <span id="last_gpm_date">
          <script>
            function pad(n) {
              if (n < 10) {
                return '0' + n.toString();
              } else {
                return n.toString();
              }
            };
            $("#last_gpm_date").load("/gpm_data/update.txt", function() {
              var d = new Date($("#last_gpm_date").html().substring(25,41));
              var gpm_date = pad(d.getDate()) + d.toDateString().substring(3, 8) + d.getFullYear().toString() + ' - ' + pad(d.getHours()) + ':' + pad(d.getMinutes()) + ' UTC';
              $("#last_gpm_date").html(gpm_date);
              });
          </script></span></h3>
<!--<h3>Last analyzed GFS date: <span id="last_gfs_date"><script> $("#last_gfs_date").load("www_last_analyzed_date_gfs.txt");</script></span></h3>
-->
        <h2>Disclaimer</h2>
        <p>The Extreme Rainfall Detection System (ERDS) is the result of a research activity devoted to the monitoring and forecasting of extreme precipitation at global scale. Although a big effort is made in order to improve the reliability of the system, the data and information provided by ERDS are currently experimental and may not be accurate, especially if intended at local scale. The web site and the data contained within it are provided on 'as available' basis, services and data may be not updated and may be withdrawn at any time and without notice. ITHACA does not assume liability for any inaccuracies in the information provided and for failure of the software.</p>
      </div>
	  
	  <!-- Layers -->
	  
      <div class="sidebar-pane" id="layers">
        <h1>Layers</h1>
        <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
		  <!-- Panel One -->
          <div class="panel panel-default">
            <div class="panel-heading" role="tab" id="headingOne">
              <h4 class="panel-title">
                <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="false" aria-controls="collapseOne">Cumulated Forecast</a>
              </h4>
            </div>
            <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
              <div class="panel-body">
                <ul class="layers">
                  <script>
                    var gfs_cum_array = new Array("last_cumulated_12h_forecast", "last_cumulated_24h_forecast", "last_cumulated_48h_forecast", "last_cumulated_72h_forecast", "last_cumulated_96h_forecast");
                    var h = new Array("12", "24", "48", "72", "96");
                    for (var i=0; i < gfs_cum_array.length; i++) {
                      document.write('<li><label><input type="checkbox" id="'+gfs_cum_array[i]+'" autocomplete="off"></input><span>FC '+ h[i]+'h</span></label><a href="/gfs_results/apcp_cumulated_'+h[i]+'.tif" class="label label-default pull-right">TIFF</a></li>');
                    }
                  </script>
                </ul>
              </div>
            </div>
          </div>
		  <!-- Panel Two -->
          <div class="panel panel-default">
            <div class="panel-heading" role="tab" id="headingTwo">
              <h4 class="panel-title">
                <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">Cumulated Near-Real-Time</a>
              </h4>
            </div>
            <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
              <div class="panel-body">
                <ul class="layers">
                  <script>
                    var gpm_cum_array = new Array("last_cumulated_12h_gpm", "last_cumulated_24h_gpm", "last_cumulated_48h_gpm", "last_cumulated_72h_gpm", "last_cumulated_96h_gpm");
                    var h = new Array("012h", "024h", "048h", "072h", "096h");
                    for (var i = 0; i < gpm_cum_array.length; i++) {
                      document.write('<li><label><input type="checkbox" id="'+gpm_cum_array[i]+'" autocomplete="off"></input><span>NRT '+ h[i]+'</span></label><a href="/gpm_data/precip_'+h[i]+'.tif" class="label label-default pull-right">TIFF</a></li>');
                    }
                  </script>
                </ul>
              </div>
            </div>
          </div>
		  <!-- Panel Three -->
          <div class="panel panel-default">
            <div class="panel-heading" role="tab" id="headingThree">
              <h4 class="panel-title">
                <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">Alert Forecast (under development)</a>
              </h4>
            </div>
            <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
              <div class="panel-body">
                <ul class="layers">
                  <script>
                    var gfs_alert_array = new Array("forecast_alert_grid_h12", "forecast_alert_grid_h24", "forecast_alert_grid_h48", "forecast_alert_grid_h72", "forecast_alert_grid_h96");
                    var h = new Array("12", "24", "48", "72", "96");
                    for (var i = 0; i < gfs_alert_array.length; i++) {
                      document.write('<li><label><input type="checkbox" id="'+gfs_alert_array[i]+'" autocomplete="off"></input><span>FC '+ h[i]+'h</span></label><a href="/gfs_results/gfs_alert_h'+h[i]+'.tif" class="label label-default pull-right">TIFF</a></li>');
                    }
                  </script>
                </ul>
              </div>
            </div>
          </div>
		  <!-- Panel Four -->
          <div class="panel panel-default">
            <div class="panel-heading" role="tab" id="headingFour">
              <h4 class="panel-title">
                <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">Alert Near-Real-Time</a>
              </h4>
            </div>
            <div id="collapseFour" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingFour">
              <div class="panel-body">
                <ul class="layers">
                  <script>
                    var gpm_alert_array = new Array("gpm_alert_h12", "gpm_alert_h24", "gpm_alert_h48", "gpm_alert_h72", "gpm_alert_h96");
                    var h = new Array("012", "024", "048", "072", "096");
                    for (var i = 0; i < gpm_alert_array.length; i++) {
                      document.write('<li><label><input type="checkbox" id="'+gpm_alert_array[i]+'" autocomplete="off" checked></input><span>NRT '+ h[i]+'h</span></label><a href="/gpm_data/alerts_'+h[i]+'h.tif" class="label label-default pull-right">TIFF</a></li>');
                     }
                   </script>
                 </ul>
               </div>
             </div>
           </div>
         </div>
       </div>
	   
	   <!-- Settings -->
			
       <div class="sidebar-pane" id="settings">
         <h1>Settings</h1>
         <h2>Map Legend</h2>
         <h3>Alerts</h3>
         <p><img src="http://5.9.20.151/geoserver/erds/wms?REQUEST=GetLegendGraphic&VERSION=1.0.0&FORMAT=image/png&WIDTH=20&HEIGHT=20&LAYER=erds:alerts_072h&LEGEND_OPTIONS=forceRule:true;dx:10;dy:0.2;mx:0.1" /></p>
         <h3>Cumulated Rainfall</h3>
         <p><img src="http://5.9.20.151/geoserver/erds/wms?REQUEST=GetLegendGraphic&VERSION=1.0.0&FORMAT=image/png&WIDTH=20&HEIGHT=20&LAYER=erds:precip_072h&LEGEND_OPTIONS=forceRule:true;dx:10;dy:0.2;mx:0.1" /></p>
       </div>
     </div>
   </div>
	
	<!-- Map -->

    <div id="map" class="sidebar-map"></div>
	
	<!-- Scripts -->

    <script src="static/js/leaflet.js"></script>
    <script src="static/js/leaflet-sidebar.js"></script>
    <script>
	    var host = "5.9.20.151";
  		var port = "80";
        var geoserver = "http://"+host+":"+port+"/geoserver/erds/wms";
        var geos_alert = "http://"+host+":"+port+"/geoserver/erds/wms";

        var map = L.map('map', {layers:world});
        map.setView([-10, -60], 2);

        var world = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
          attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery &copy; <a href="http://mapbox.com">Mapbox</a>',
          maxZoom: 18,
          id: 'mapbox.dark',
          accessToken: 'pk.eyJ1IjoicGFvbG9wYXNxdWFsaSIsImEiOiJoVU9zSE9VIn0.O8Cehs_li5LA2aLurdEDJQ'
        }).addTo(map);

    var forecast_alert_grid_h12  = new L.tileLayer.wms(geos_alert, {layers: 'erds:gfs_apcp_alerts_012h', format: 'image/png', transparent: true});
    var forecast_alert_grid_h24  = new L.tileLayer.wms(geos_alert, {layers: 'erds:gfs_apcp_alerts_024h', format: 'image/png', transparent: true});
    var forecast_alert_grid_h48  = new L.tileLayer.wms(geos_alert, {layers: 'erds:gfs_apcp_alerts_048h', format: 'image/png', transparent: true});
    var forecast_alert_grid_h72  = new L.tileLayer.wms(geos_alert, {layers: 'erds:gfs_apcp_alerts_072h', format: 'image/png', transparent: true});
    var forecast_alert_grid_h96  = new L.tileLayer.wms(geos_alert, {layers: 'erds:gfs_apcp_alerts_096h', format: 'image/png', transparent: true});
    forecast_alert_grid_h12.setZIndex(2);
    forecast_alert_grid_h24.setZIndex(2);
    forecast_alert_grid_h48.setZIndex(2);
    forecast_alert_grid_h72.setZIndex(2);
    forecast_alert_grid_h96.setZIndex(2);

    var last_cumulated_12h_forecast  = new L.tileLayer.wms(geoserver, {layers: 'erds:gfs_apcp_accumulated_012h', format: 'image/png', transparent: true});
    var last_cumulated_24h_forecast  = new L.tileLayer.wms(geoserver, {layers: 'erds:gfs_apcp_accumulated_024h', format: 'image/png', transparent: true});
    var last_cumulated_48h_forecast  = new L.tileLayer.wms(geoserver, {layers: 'erds:gfs_apcp_accumulated_048h', format: 'image/png', transparent: true});
    var last_cumulated_72h_forecast  = new L.tileLayer.wms(geoserver, {layers: 'erds:gfs_apcp_accumulated_072h', format: 'image/png', transparent: true});
    var last_cumulated_96h_forecast  = new L.tileLayer.wms(geoserver, {layers: 'erds:gfs_apcp_accumulated_096h', format: 'image/png', transparent: true});
    last_cumulated_12h_forecast.setZIndex(2);
    last_cumulated_24h_forecast.setZIndex(2);
    last_cumulated_48h_forecast.setZIndex(2);
    last_cumulated_72h_forecast.setZIndex(2);
    last_cumulated_96h_forecast.setZIndex(2);

	  var last_cumulated_12h_gpm = new L.tileLayer.wms(geoserver, {layers: 'erds:precip_012h', format: 'image/png', transparent: true, maxZoom: 10, minZoom: 2});
    var last_cumulated_24h_gpm  = new L.tileLayer.wms(geoserver, {layers: 'erds:precip_024h', format: 'image/png', transparent: true, maxZoom: 10, minZoom: 2});
    var last_cumulated_48h_gpm  = new L.tileLayer.wms(geoserver, {layers: 'erds:precip_048h', format: 'image/png', transparent: true, maxZoom: 10, minZoom: 2});
    var last_cumulated_72h_gpm  = new L.tileLayer.wms(geoserver, {layers: 'erds:precip_072h', format: 'image/png', transparent: true, maxZoom: 10, minZoom: 2});
    var last_cumulated_96h_gpm  = new L.tileLayer.wms(geoserver, {layers: 'erds:precip_096h', format: 'image/png', transparent: true, maxZoom: 10, minZoom: 2});
    last_cumulated_12h_gpm.setZIndex(2);
    last_cumulated_24h_gpm.setZIndex(2);
    last_cumulated_48h_gpm.setZIndex(2);
    last_cumulated_72h_gpm.setZIndex(2);
    last_cumulated_96h_gpm.setZIndex(2);

    var gpm_alert_h12 = new L.tileLayer.wms(geos_alert, {layers: 'erds:alerts_012h', format: 'image/png', transparent: true, maxZoom: 10, minZoom: 2});
    var gpm_alert_h24 = new L.tileLayer.wms(geos_alert, {layers: 'erds:alerts_024h', format: 'image/png', transparent: true, maxZoom: 10, minZoom: 2});
    var gpm_alert_h48 = new L.tileLayer.wms(geos_alert, {layers: 'erds:alerts_048h', format: 'image/png', transparent: true, maxZoom: 10, minZoom: 2});
    var gpm_alert_h72 = new L.tileLayer.wms(geos_alert, {layers: 'erds:alerts_072h', format: 'image/png', transparent: true, maxZoom: 10, minZoom: 2});
    var gpm_alert_h96 = new L.tileLayer.wms(geos_alert, {layers: 'erds:alerts_096h', format: 'image/png', transparent: true, maxZoom: 10, minZoom: 2});

    gpm_alert_h12.setZIndex(2);
    gpm_alert_h24.setZIndex(2);
    gpm_alert_h48.setZIndex(2);
    gpm_alert_h72.setZIndex(2);
    gpm_alert_h96.setZIndex(2);

    var overlays = {
      "last_cumulated_12h_forecast":last_cumulated_12h_forecast,
      "last_cumulated_24h_forecast":last_cumulated_24h_forecast,
      "last_cumulated_48h_forecast":last_cumulated_48h_forecast,
      "last_cumulated_72h_forecast":last_cumulated_72h_forecast,
      "last_cumulated_96h_forecast":last_cumulated_96h_forecast,
      "last_cumulated_12h_gpm":last_cumulated_12h_gpm,
      "last_cumulated_24h_gpm":last_cumulated_24h_gpm,
      "last_cumulated_48h_gpm":last_cumulated_48h_gpm,
      "last_cumulated_72h_gpm":last_cumulated_72h_gpm,
      "last_cumulated_96h_gpm":last_cumulated_96h_gpm,
      "forecast_alert_grid_h12":forecast_alert_grid_h12,
      "forecast_alert_grid_h24":forecast_alert_grid_h24,
      "forecast_alert_grid_h48":forecast_alert_grid_h48,
      "forecast_alert_grid_h72":forecast_alert_grid_h72,
      "forecast_alert_grid_h96":forecast_alert_grid_h96,
  	  "gpm_alert_h12":gpm_alert_h12,    
  	  "gpm_alert_h24":gpm_alert_h24,
      "gpm_alert_h48":gpm_alert_h48,
      "gpm_alert_h72":gpm_alert_h72,
      "gpm_alert_h96":gpm_alert_h96,
	      };
    
   var sidebar = L.control.sidebar('sidebar').addTo(map);
   map.addLayer(gpm_alert_h12);
   map.addLayer(gpm_alert_h24);
   map.addLayer(gpm_alert_h48);
   map.addLayer(gpm_alert_h72);
   map.addLayer(gpm_alert_h96);
	//map.addLayer(erds_admin1);
  // map.addLayer(flooded_population_h24); 

    //function for add and remove layer according to the name of layer checked

    $(document).ready(function(){
     // updateAlerts();
      $(":checkbox").change(function(){
        var checkboxIDs = [];
        $(":checkbox:checked").each(function(index){
          checkboxIDs.push($(this).attr('id'));
        })
        if(checkboxIDs.indexOf($(this).attr('id')) > -1){
          //console.log($(this).attr('id'));
          var newLayer = overlays[$(this).attr('id')];
          //console.log(newLayer)
          map.addLayer(newLayer);
        } else {
          //console.log($(this).attr('id') + ' unchecked');
          var newLayer = overlays[$(this).attr('id')];
          map.removeLayer(newLayer);
        }
      });
    });

  </script>
